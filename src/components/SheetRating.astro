---
export interface Props {
  sheetId: number;
  avg: number | null;
  count: number | null;
}
const { sheetId, avg, count } = Astro.props as Props;
const displayAvg = typeof avg === "number" ? avg.toFixed(2) : "-";
const displayCount = count ?? 0;
---

<div
  class="sheet-rating space-y-2"
  data-rating-widget
  data-sheet-id={sheetId}
  data-current-rating={typeof avg === "number" ? avg : ""}
>
  <div class="flex items-center justify-between">
    <p class="text-sm text-global-text-muted">
      Dificultad: <span class="font-bold text-global-primary" data-rating-value
        >{displayAvg}</span
      >
    </p>
    <p class="text-xs text-global-text-muted">
      <span data-rating-count>{displayCount}</span> votos
    </p>
  </div>

  <div
    class="bg-global-bg/30 rounded-2xl py-2 px-3 border border-transparent transition-colors"
  >
    <div
      class="flex items-center justify-between sm:justify-center gap-0.5 sm:gap-3 w-full"
    >
      <span
        class="text-[10px] font-medium text-global-text-muted uppercase tracking-wider w-auto sm:w-12 text-left leading-tight"
      >
        Fácil
      </span>

      <div class="flex justify-center gap-0.5 sm:gap-1">
        {
          Array.from({ length: 5 }).map((_, idx) => {
            const val = idx + 1;
            return (
              <button
                type="button"
                class="star-btn w-6 h-6 sm:w-9 sm:h-9 flex items-center justify-center rounded-xl hover:bg-global-bg transition-all focus:outline-none focus:ring-2 focus:ring-global-primary/50 cursor-pointer"
                data-score={val}
                aria-label={`${val} estrellas`}
              >
                <svg
                  class="w-4 h-4 sm:w-7 sm:h-7 pointer-events-none transition-transform duration-200 star-inactive"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
              </button>
            );
          })
        }
      </div>

      <span
        class="text-[10px] font-medium text-global-text-muted uppercase tracking-wider w-auto sm:w-12 text-right leading-tight"
      >
        Difícil
      </span>
    </div>
  </div>

  <p class="text-xs text-global-text-muted text-center" data-rating-status></p>

  <!-- Botón para quitar voto (oculto por defecto) -->
  <button
    type="button"
    id="remove-vote-btn"
    data-remove-vote
    class="hidden w-full text-xs text-global-text-muted hover:text-red-400 underline underline-offset-2 transition-colors cursor-pointer py-1"
  >
    Quitar mi voto
  </button>
</div>

<style>
  .star-inactive {
    color: rgba(180, 189, 201, 0.3);
  }
</style>
