---
import IconStar from './icons/IconStar.astro';

export interface Props {
  name: string;
  role: string;
  rating?: number; // 0-5
  avatarSrc?: string;
  href?: string;
  class?: string;
  alt?: string;
}

const {
  name,
  role,
  rating = 0,
  avatarSrc,
  href,
  class: extraClass = "",
  alt,
} = Astro.props as Props;

const safeRating = Math.max(0, Math.min(5, Math.round(rating)));
const stars = Array.from({ length: 5 });
---

<div class={`bg-global-card rounded-2xl p-8 flex flex-col items-center gap-8 text-center${extraClass}`}>
  {
    href ? (
      <a
        href={href}
        class="block focus:outline-none focus-visible:ring-2 focus-visible:ring-[#51A624] rounded-2xl"
        aria-label={`Ver perfil de ${name}`}
      >
        <div class="mx-auto w-40 h-40 sm:w-44 sm:h-44 rounded-full bg-global-bg outline outline-2 outline-global-border shadow">
          {avatarSrc ? (
            <img
              src={avatarSrc}
              alt={alt ?? `Foto de ${name}`}
              class="w-full h-full rounded-full object-cover"
              loading="lazy"
              decoding="async"
            />
          ) : null}
        </div>
      </a>
    ) : (
      <div class="mx-auto w-auto h-full sm:w-44 sm:h-44 rounded-full bg-global-bg outline outline-2 outline-global-card shadow">
        {avatarSrc ? (
          <img
            src={avatarSrc}
            alt={alt ?? `Foto de ${name}`}
            class="w-full h-full rounded-full object-cover"
            loading="lazy"
            decoding="async"
          />
        ) : null}
      </div>
    )
  }

  <div class="space-y-2">
    <h3 class="text-2xl font-semibold text-global-text">{name}</h3>
    <p class="text-lg font-medium text-global-text-muted">{role}</p>
  </div>

  <div class="flex items-center gap-2" aria-label={`CalificaciÃ³n: ${safeRating} de 5`}>
    {stars.map((_, i) => (
      <IconStar filled={i < safeRating} class="text-global-primary" />
    ))}
  </div>
</div>
