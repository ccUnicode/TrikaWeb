---
export interface Props {
  name: string;
  role: string;
  rating?: number; // 0-5
  avatarSrc?: string;
  href?: string;
  class?: string;
  alt?: string;
}

const {
  name,
  role,
  rating = 0,
  avatarSrc,
  href,
  class: extraClass = "",
  alt,
} = Astro.props as Props;

const safeRating = Math.max(0, Math.min(5, Math.round(rating)));
const stars = Array.from({ length: 5 });
---

<div class={`bg-global-card rounded-2xl p-6 flex flex-col items-center gap-4 text-center ${extraClass}`}>
  {
    href ? (
      <a
        href={href}
        class="block focus:outline-none focus-visible:ring-2 focus-visible:ring-[#51A624] rounded-2xl"
        aria-label={`Ver perfil de ${name}`}
      >
        <div class="mx-auto w-40 h-40 sm:w-44 sm:h-44 rounded-full bg-global-bg outline outline-2 outline-global-card shadow">
          {avatarSrc ? (
            <img
              src={avatarSrc}
              alt={alt ?? `Foto de ${name}`}
              class="w-full h-full rounded-full object-cover"
              loading="lazy"
              decoding="async"
            />
          ) : null}
        </div>
      </a>
    ) : (
      <div class="mx-auto w-40 h-40 sm:w-44 sm:h-44 rounded-full bg-global-bg outline outline-2 outline-global-card shadow">
        {avatarSrc ? (
          <img
            src={avatarSrc}
            alt={alt ?? `Foto de ${name}`}
            class="w-full h-full rounded-full object-cover"
            loading="lazy"
            decoding="async"
          />
        ) : null}
      </div>
    )
  }

  <div class="space-y-2">
    <h3 class="text-2xl font-semibold text-global-text">{name}</h3>
    <p class="text-lg font-medium text-global-text-muted">{role}</p>
  </div>

  <div class="flex items-center gap-2" aria-label={`CalificaciÃ³n: ${safeRating} de 5`}>
    {stars.map((_, i) => (
      <svg
        width="22"
        height="22"
        viewBox="0 0 22 22"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        {i < safeRating ? (
          <path
            d="M11 1L14.09 7.26L21 8.27L16 13.14L17.18 20.02L11 16.77L4.82 20.02L6 13.14L1 8.27L7.91 7.26L11 1Z"
            fill="currentColor"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-global-primary"
          />
        ) : (
          <path
            d="M11 1L14.09 7.26L21 8.27L16 13.14L17.18 20.02L11 16.77L4.82 20.02L6 13.14L1 8.27L7.91 7.26L11 1Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-global-primary"
          />
        )}
      </svg>
    ))}
  </div>
</div>
