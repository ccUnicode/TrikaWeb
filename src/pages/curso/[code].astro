---
export const prerender = false;
import Layout from "../../layouts/Layout.astro";
import CardExam from "../../components/CardExam.astro";
import { getCourseByCode } from "../../lib/data";

const code = Astro.params.code ?? "";
const course = await getCourseByCode(code);
if (!course) {
  return Astro.redirect("/cursos");
}
---

<Layout title={`Curso ${course.code}`}>
  <main class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-12 py-10 space-y-8">
    <header class="space-y-2 border-b border-global-border/50 pb-6">
      <p class="text-sm uppercase tracking-[0.3em] text-global-text-muted">
        Curso
      </p>
      <h1 class="text-3xl font-bold text-global-text">
        {course.code} - {course.name}
      </h1>
      <p class="text-sm text-global-text-muted">
        {course.sheetCount} planchas registradas
      </p>
    </header>

    {
      course.sheets.length === 0 ? (
        <p class="rounded-2xl border border-dashed border-global-border/60 bg-global-surface p-6 text-center text-global-text-muted">
          Aun no hay planchas para este curso.
        </p>
      ) : (
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {course.sheets.map((sheet) => (
            <CardExam
              evaluacion={sheet.exam_type}
              ciclo={sheet.cycle}
              profesor={sheet.teacher_hint || "Varios profesores"}
              tieneSolucion={!!sheet.solution_kind}
              href={`/exams/${sheet.id}`}
            />
          ))}
        </div>
      )
    }
  </main>
</Layout>
