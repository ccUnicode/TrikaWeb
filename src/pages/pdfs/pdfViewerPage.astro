
---
import SiteHeader from "../../components/SiteHeader.astro";
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BMA03 - TrikaWeb</title>
  </head>

  <body class="min-h-screen bg-[#070809] text-white">
    <SiteHeader />

    <main class="mx-auto mb-10 w-[44.8%] max-w-[900px] px-0">
      <div id="header-container"
           class="sticky top-[72px] z-[1000] mb-0 flex items-center justify-between gap-3 rounded-xl bg-[#171A1F] px-4 py-4">
        <h3 id="viewer-title" class="m-0 text-[26px] leading-none">PC N°1 - 2024 II</h3>
        <div class="flex items-center gap-2">
          <button id="download-btn" class="rounded-lg bg-[#2A3240] px-4 py-2 hover:bg-[#1E2430]">Descargar PDF</button>
          <button id="open-direct-btn" class="rounded-lg bg-[#2A3240] px-4 py-2 hover:bg-[#1E2430]">Ver directo</button>
          <button id="solution-btn" class="rounded-lg bg-[#2A3240] px-4 py-2 hover:bg-[#1E2430]">Solucionario</button>
          <button id="exit-btn" class="rounded-lg bg-[#2A3240] px-3 py-2 hover:bg-[#1E2430]">X</button>
        </div>
      </div>

      <div id="pdf-container"
           class="flex h-[1205px] w-full justify-center border-4 border-[#171A1F] p-5">
      </div>
    </main>

    <footer class="mt-auto w-full bg-black py-2 text-center text-sm text-white">
      © 2024 TrikaWeb. Todos los derechos reservados.
    </footer>

    <script is:inline>
      function getParam(name) {
        const params = new URLSearchParams(window.location.search);
        const v = params.get(name);
        return v && v.trim() ? v.trim() : null;
      }

      const fileParam = getParam('file'); // e.g., plancha1.pdf
      const solutionParam = getParam('solution'); // e.g., plancha1-solucionario.pdf
      const titleParam = getParam('title'); // e.g., "PC1 - 2024 II"

      const titleEl = document.getElementById('viewer-title');
      if (titleEl && titleParam) {
        titleEl.textContent = titleParam;
      }

      const buildUrl = (filename) => `/pdfs/${filename}`;
      const pdfUrl = fileParam ? buildUrl(fileParam) : '/pdfs/plancha1.pdf';

      const downloadBtn = document.getElementById('download-btn');
      const solutionBtn = document.getElementById('solution-btn');
      const openDirectBtn = document.getElementById('open-direct-btn');
      const exitBtn = document.getElementById('exit-btn');

      openDirectBtn?.addEventListener('click', () => {
        window.open(pdfUrl, '_blank');
      });

      downloadBtn?.addEventListener('click', () => {
        const a = document.createElement('a');
        a.href = pdfUrl;
        const fname = fileParam || 'plancha1.pdf';
        a.download = fname;
        a.click();
      });

      if (solutionParam) {
        solutionBtn?.addEventListener('click', () => {
          window.open(buildUrl(solutionParam), '_blank');
        });
      } else {
        solutionBtn?.classList.add('hidden');
      }

      exitBtn?.addEventListener('click', () => {
        window.location.href = '/';
      });

      function renderEmbed() {
        const container = document.getElementById('pdf-container');
        if (!container) return;
        container.innerHTML = '';
        const iframe = document.createElement('iframe');
        iframe.src = pdfUrl + '#toolbar=0';
        iframe.className = 'w-full h-full rounded-lg bg-[#0b0e13]';
        iframe.setAttribute('loading', 'lazy');
        container.appendChild(iframe);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderEmbed);
      } else {
        renderEmbed();
      }
    </script>
  </body>
</html>
