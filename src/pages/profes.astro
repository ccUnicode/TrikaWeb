---
import Layout from '../layouts/Layout.astro';
import TeacherCard from '../components/TeacherCard.astro';
import { getTeachers } from '../lib/data';

const teachers = await getTeachers();
---

<Layout title="Profesores | TrikaWeb">
  <main class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-12 py-10 space-y-8">
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold text-global-text">Profesores</h1>
        <p class="text-global-text-muted mt-2">
          Encuentra a tu profesor y revisa sus calificaciones.
        </p>
      </div>
      
      <div class="relative w-full md:w-96">
        <input
          type="search"
          id="search-teacher"
          placeholder="Buscar por nombre o curso..."
          class="w-full rounded-full bg-global-surface border border-global-border px-4 py-2.5 text-global-text placeholder:text-global-text-muted focus:border-global-primary focus:outline-none focus:ring-1 focus:ring-global-primary"
        />
        <svg
          class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-global-text-muted"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
    </header>

    {teachers.length === 0 ? (
      <p class="text-center text-global-text-muted py-10">
        No hay profesores registrados.
      </p>
    ) : (
      <div id="teachers-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {teachers.map(teacher => (
          <article
            class="teacher-item"
            data-name={teacher.full_name}
            data-courses={teacher.courses.map(c => c.name).join(',')}
          >
            <TeacherCard
              name={teacher.full_name}
              role="Profesor"
              rating={teacher.avg_overall ?? 0}
              avatarSrc="/img/teacher.png"
              href="#" 
              buttonLabel="Ver perfil"
            />
          </article>
        ))}
      </div>
    )}
    
    <p id="no-results" class="hidden text-center text-global-text-muted py-10">
      No se encontraron profesores que coincidan con tu b√∫squeda.
    </p>
  </main>
</Layout>

<script>
  const input = document.getElementById('search-teacher') as HTMLInputElement;
  const grid = document.getElementById('teachers-grid');
  const noResults = document.getElementById('no-results');
  const items = document.querySelectorAll('.teacher-item');

  if (input && grid) {
    input.addEventListener('input', (e) => {
      const term = (e.target as HTMLInputElement).value.toLowerCase();
      let visibleCount = 0;

      items.forEach((item) => {
        const el = item as HTMLElement;
        const name = (el.dataset.name || '').toLowerCase();
        const courses = (el.dataset.courses || '').toLowerCase();
        
        const matches = name.includes(term) || courses.includes(term);
        if (matches) {
          el.classList.remove('hidden');
          visibleCount++;
        } else {
          el.classList.add('hidden');
        }
      });

      if (visibleCount === 0) {
        grid.classList.add('hidden');
        noResults?.classList.remove('hidden');
      } else {
        grid.classList.remove('hidden');
        noResults?.classList.add('hidden');
      }
    });
  }
</script>
